<!DOCTYPE html>

<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
    <meta name="author" content="Pavel Prchal">

    <title>Hydropad</title>
    <!-- CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    
    <script>
        window.post = function (url, data) {
            return fetch(url, { method: "POST", body: JSON.stringify(data) })
        }

        function oscCommand(cmd, param) {
            let qcmd = ""
            if(param === undefined){
                qcmd = `osc/${cmd}`
            }else{
                qcmd = `osc/${cmd}/${param}`
            }
            post(qcmd, { param: param });
        }

        let prevDate = new Date()
        let prevBPM = 60
        function tapTempo() {
            let date = new Date()
            let delta = (date - prevDate) / 1000
            prevDate = date

            // 40 BPM is minimum, wait for next tap
            let bpm = 40
            if(delta >= 1.5){
                console.debug('wait')
            }else{
                // tbetw[0,5] = 60 / BPM(120)
                let currentBPM = 60 / delta
                bpm = Math.floor((60 * currentBPM  + 40 * prevBPM) / 100)
            }

            document.getElementById('divBPM').innerText = bpm
        }
    </script>
</head>

<body>
    <h3>Hydropad</h3>
    <div class="container">
        <input type="button" onclick="oscCommand('PLAY')" value="start" class="one-third column button button-primary" />
        <input type="button" onclick="oscCommand('STOP')" value="stop" class="one-third column button" />
        
        <input type="button" onclick="oscCommand('BPM_INCR')" value="BPM +" class="one-third column button" />
        <input type="button" onclick="oscCommand('BPM_DECR')" value="BPM -" class="one-third column button" />

        <input type="button" onclick="oscCommand('MASTER_VOLUME_RELATIVE', 1)" value="Volume +" class="one-third column button" />
        <input type="button" onclick="oscCommand('MASTER_VOLUME_RELATIVE', -1)" value="Volume -" class="one-third column button" />

        <div id="divBPM"></div>
        <input type="button" onclick="tapTempo()" value="Tap tempo" class="one-third column button" />

        <div>Pavel Prchal, 2022</div>
    </div>
</body>

</html>
